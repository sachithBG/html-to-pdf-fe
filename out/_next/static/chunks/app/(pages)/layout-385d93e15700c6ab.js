(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7133],{47446:(e,t,n)=>{Promise.resolve().then(n.bind(n,20126))},20126:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ez});var i=n(95155),a=n(12115),r=n(50811),o=n(2227),l=n(50038),s=n(39651),d=n(8198),u=n(77145),c=n(25921),g=n(43655),m=n(7882),h=n(21498),p=n(76046),x=n(68998),f=n(13656),v=n(48123),A=n(65518),j=n(20963),y=n(8045),S=n(31306),w=n(79670),b=n(10979),z=n(2241),k=n(9561),C=n(58146),P=n(91888),I=n(2091),M=n(30562),E=n(60391),_=n(26603),O=n(31303),q=n(95213),T=n(8425),N=n(77740),D=n(83391),L=n(90917),R=n(76487);function B(){let{organizations:e}=(0,D.d4)(e=>e.organization),t=(0,D.wA)(),n=(0,p.useRouter)(),{token:a}=(0,D.d4)(e=>e.session),r=n=>{(0,R.lf)(n,a).then(i=>{(null==i?void 0:i.status)==200&&(t((0,L.o_)()),t((0,L.SH)(e.map(e=>({...e,is_default:e.id===n})))))}).catch(e=>{console.error(e)})};return(0,i.jsxs)(b.A,{direction:"column",children:[(0,i.jsx)(O.m,{variant:"expanded"}),(0,i.jsx)(z.A,{}),(0,i.jsx)(k.A,{variant:"body2",mx:2,mt:1,children:"Organizations"}),(0,i.jsxs)(C.A,{children:[null==e?void 0:e.map(e=>{var t,n;return(0,i.jsxs)(P.A,{component:"button",sx:{justifyContent:"flex-start",width:"100%",columnGap:2},onClick:()=>r(e.id),children:[(0,i.jsx)(I.A,{children:(0,i.jsx)(M.A,{sx:{width:32,height:32,fontSize:"0.95rem",bgcolor:"#8B4513"},src:null!==(t=e.logo)&&void 0!==t?t:"",alt:null!==(n=e.name)&&void 0!==n?n:"",children:e.name[0]})}),(0,i.jsx)(E.A,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},primary:e.name,secondary:e.is_default?"Active":"",slotProps:{primary:{variant:"body2"},secondary:{variant:"caption"}}})]},e.id)}),(0,i.jsx)(z.A,{}),(0,i.jsx)(_.A,{variant:"text",sx:{textTransform:"capitalize",display:"flex",mx:"auto"},size:"small",startIcon:(0,i.jsx)(N.A,{}),disableElevation:!0,onClick:()=>n.push("/organization"),children:"Add new"})]}),(0,i.jsx)(z.A,{}),(0,i.jsx)(q.y,{children:(0,i.jsx)(T.c,{})})]})}var F=n(96335),U=n(76357),W=n(39905),H=n(11441),Z=n(22678),G=n(90507),J=n(97975),Y=n(894),K=n(60615),Q=n(83726),V=n(78416),X=n(6327),$=n(74676),ee=n(31798),et=n(9313),en=n(25033);let ei=async(e,t,n)=>en.n.post("/users/login",{email:e,password:t,rememberMe:n},{withCredentials:!0}),ea=async(e,t,n)=>{try{return(await en.n.post("/users/register",{name:e,email:t,password:n},{withCredentials:!0})).data}catch(e){if(e.response)throw Error(e.response.data.error||"An error occurred during registration.");if(e.request)throw Error("No response from the server. Please try again later.");throw Error("Error in setting up the request. Please try again.")}};var er=n(37264);let eo=[{id:"credentials",name:"Email and Password"}];function el(){return(0,i.jsx)(W.A,{id:"input-with-icon-textfield",label:"Email",name:"email",type:"email",size:"small",required:!0,fullWidth:!0,slotProps:{input:{startAdornment:(0,i.jsx)(H.A,{position:"start",children:(0,i.jsx)($.A,{fontSize:"inherit"})})}},variant:"outlined"})}function es(){let[e,t]=a.useState(!1);return(0,i.jsxs)(Z.A,{sx:{my:2},fullWidth:!0,variant:"outlined",children:[(0,i.jsx)(G.A,{size:"small",htmlFor:"outlined-adornment-password",children:"Password"}),(0,i.jsx)(J.A,{id:"outlined-adornment-password",type:e?"text":"password",name:"password",size:"small",endAdornment:(0,i.jsx)(H.A,{position:"end",children:(0,i.jsx)(Y.A,{"aria-label":"toggle password visibility",onClick:()=>t(e=>!e),onMouseDown:e=>{e.preventDefault()},edge:"end",size:"small",children:e?(0,i.jsx)(ee.A,{fontSize:"inherit"}):(0,i.jsx)(et.A,{fontSize:"inherit"})})}),label:"Password"})]})}function ed(){return(0,i.jsx)(_.A,{type:"submit",variant:"outlined",color:"info",size:"small",disableElevation:!0,fullWidth:!0,sx:{my:2},children:"Log In"})}let eu=async(e,t,n,i)=>new Promise(async a=>{if("credentials"===e.id){i((0,er.r1)());let e={redirect:!1,email:null==t?void 0:t.get("email"),password:null==t?void 0:t.get("password"),rememberMe:null==t?void 0:t.get("rememberMe")};try{let t=await ei(e.email,e.password,e.rememberMe);if(200==t.status){let{token:e,user:r}=t.data;i((0,er.Nq)({token:e,user:r,status:"authenticated"})),localStorage.setItem("token",e),a({success:"Check your email for a verification link."}),n(!1)}else i((0,er.q7)()),a({error:"An error occurred during signin."})}catch(e){console.log(e),i((0,er.q7)()),a({error:null==e?void 0:e.error})}}else n(!1),setTimeout(()=>{console.log("Sign in with ".concat(e.id)),a({error:"Invalid credentials."})},500)});function ec(){let[e,t]=a.useState(!1);return(0,i.jsx)(K.A,{control:(0,i.jsx)(Q.A,{name:"rememberMe",checked:e,value:e,onChange:e=>t(e.target.checked),color:"primary",sx:{padding:.5,"& .MuiSvgIcon-root":{fontSize:20}}}),slotProps:{typography:{fontSize:14}},color:"textSecondary",label:"Remember me"})}function eg(e){let{open:t,onClose:n,setSignUpModalOpen:a}=e,r=(0,D.wA)(),o=()=>{n(!1),a(!0)},l=()=>{n(!1),a(!0)};return(0,i.jsxs)(V.A,{open:t,onClose:()=>{n(!1)},sx:{m:0,p:0,"& .MuiPaper-root, .MuiBox-root":{minHeight:"unset"},"& .MuiContainer-root":{p:0}},children:[(0,i.jsx)(Y.A,{"aria-label":"close",onClick:()=>n(!1),sx:e=>({position:"absolute",right:8,top:8,color:e.palette.grey[500]}),children:(0,i.jsx)(X.A,{})}),(0,i.jsx)(U.q,{signIn:(e,t)=>eu(e,t,n,r),providers:eo,sx:{"& form > .MuiStack-root":{marginTop:"2rem",rowGap:"0.5rem"}},slots:{title:()=>(0,i.jsx)("h2",{style:{marginBottom:8,minWidth:"400px",textAlign:"center"},children:"Login"}),signUpLink:()=>(0,i.jsx)(k.A,{variant:"body2",onClick:o,sx:{cursor:"pointer"},children:"Sign up"}),forgotPasswordLink:()=>(0,i.jsx)(k.A,{variant:"body2",onClick:l,children:"Forgot password?"}),emailField:el,passwordField:es,submitButton:ed,rememberMe:ec}})]})}var em=n(10897);let eh=e=>{let{setSignInModalOpen:t,openSignUp:n,setSignUpModalOpen:r}=e,[o,l]=(0,a.useState)(""),[s,d]=(0,a.useState)(""),[u,c]=(0,a.useState)(""),[m,h]=(0,a.useState)(!1),[p,v]=(0,a.useState)(!1),[A,j]=(0,a.useState)(!1),y=(0,a.useRef)(null),S=(0,a.useRef)(null),w=(0,a.useRef)(null),[b,z]=(0,a.useState)(null),[C,P]=(0,a.useState)(null),I=()=>{var e,t,n;let i=!0;return o.trim()||(h(!0),null===(e=y.current)||void 0===e||e.focus(),i=!1),s.trim()||(v(!0),i&&(null===(t=S.current)||void 0===t||t.focus()),i=!1),u.trim()||(j(!0),i&&(null===(n=w.current)||void 0===n||n.focus()),i=!1),i},M=async e=>{if(e.preventDefault(),I())try{let e=await ea(o,s,u);console.log(e),(null==e?void 0:e.name)&&(null==e?void 0:e.email)?(z("Signup successful! Redirecting to sign-in..."),P(null),setTimeout(()=>{z(null),E()},2e3)):((null==e?void 0:e.error)?P(e.error):P("Something went wrong. Please try again."),z(null))}catch(e){console.error("Signup error:",e),P(e.message),z(null)}},E=()=>{t(!0),r(!1)};return(0,i.jsxs)(V.A,{open:n,onClose:()=>r(!1),children:[(0,i.jsx)(Y.A,{"aria-label":"close",onClick:()=>r(!1),sx:e=>({position:"absolute",right:8,top:8,color:e.palette.grey[500]}),children:(0,i.jsx)(X.A,{})}),(0,i.jsxs)(x.A,{component:"form",onSubmit:M,sx:{width:"100%",maxWidth:"444px",bgcolor:"background.paper",boxShadow:24,p:4},children:[(0,i.jsxs)(g.A,{container:!0,spacing:2,direction:"column",alignItems:"center",children:[(0,i.jsx)(g.A,{children:(0,i.jsx)(f.A,{color:"info"})}),(0,i.jsx)(g.A,{children:(0,i.jsx)(k.A,{children:"Sign Up"})})]}),(0,i.jsx)(W.A,{inputRef:y,label:"Name",value:o,onChange:e=>{l(e.target.value),h(!1)},onBlur:()=>!o.trim()&&h(!0),error:m,helperText:m?"Name is required.":"",fullWidth:!0,margin:"normal"}),(0,i.jsx)(W.A,{inputRef:S,label:"Email",type:"email",value:s,onChange:e=>{d(e.target.value),v(!1)},onBlur:()=>!s.trim()&&v(!0),error:p,helperText:p?"Email is required.":"",fullWidth:!0,margin:"normal"}),(0,i.jsx)(W.A,{inputRef:w,label:"Password",type:"password",value:u,onChange:e=>{c(e.target.value),j(!1)},onBlur:()=>!u.trim()&&j(!0),error:A,helperText:A?"Password is required.":"",fullWidth:!0,margin:"normal",slotProps:{htmlInput:e=>(console.log(e),{maxLength:8,minLength:3})}}),b&&(0,i.jsx)(em.A,{severity:"success",sx:{mb:2},children:b}),C&&(0,i.jsx)(em.A,{severity:"error",sx:{mb:2},children:C}),(0,i.jsx)(_.A,{type:"submit",variant:"outlined",size:"small",color:"primary",fullWidth:!0,children:"Sign Up"}),(0,i.jsxs)(x.A,{sx:{mt:2,display:"flex",justifyContent:"center"},children:[(0,i.jsxs)(k.A,{variant:"body2",sx:{mr:1},children:["Already have an account?"," "]}),(0,i.jsx)(k.A,{variant:"body2",onClick:E,sx:{cursor:"pointer"},color:"primary",children:"Sign In"})]})]})]})};var ep=n(32731),ex=n(79329),ef=n(68488),ev=n.n(ef);class eA{constructor(e){this.user={name:null==e?void 0:e.name,email:null==e?void 0:e.email,image:null==e?void 0:e.avatar}}}function ej(){let[e,t]=a.useState(null),[n,r]=a.useState(!1),[o,l]=a.useState(!1),s=(0,D.wA)(),{setMode:u}=(0,ex.Ut)(),{token:c,user:g}=(0,D.d4)(e=>e.session),m=()=>{r(!0)},h=a.useMemo(()=>({signIn:()=>{m()},signOut:()=>{t(null),console.log("Sign out"),s((0,er.q7)()),localStorage.removeItem("token")}}),[]);return a.useEffect(()=>{let e=localStorage.getItem("token"),n=ev().decode(e),i=(null==n?void 0:n.user)?JSON.parse(null==n?void 0:n.user):null;if(i){var a;t(()=>{var e;return new eA({...i,avatar:null==i?void 0:null===(e=i.profile)||void 0===e?void 0:e.avatar})}),console.log(i),(0,R.xi)(i.id,c).then(e=>{console.log(e.data,"Organizations fetched"),e.data&&e.data.length>0&&(console.log("Dispatching organizations"),s((0,L.o_)()),s((0,L.SH)(e.data)))}).catch(e=>{console.log(e,"Error fetching organizations")}),u((null==i?void 0:null===(a=i.profile)||void 0===a?void 0:a.theme)||"light")}return ep.y.on("triggerSignIn",m),()=>{s((0,L.o_)()),ep.y.off("triggerSignIn",m)}},[null==g?void 0:g.id]),(0,i.jsx)(d.gZ.Provider,{value:h,children:(0,i.jsxs)(d.IC.Provider,{value:e,children:[(0,i.jsx)(F.H,{}),(0,i.jsx)(eg,{open:n,onClose:r,setSignUpModalOpen:l}),(0,i.jsx)(eh,{setSignInModalOpen:r,openSignUp:o,setSignUpModalOpen:l}),(0,i.jsx)(w.g,{slots:{popoverContent:B}})]})})}let ey=()=>{let e=(0,D.wA)();(0,a.useEffect)(()=>{(async()=>{e((0,er.r1)());let t=localStorage.getItem("token");if(t)try{let n=ev().decode(t);if(n){let i=(null==n?void 0:n.user)?JSON.parse(null==n?void 0:n.user):null;e((0,er.Nq)({token:t,user:{id:n.sub,name:n.name,email:n.email,profile:(null==i?void 0:i.profile)||{id:null,theme:"light",avatar:null}},status:"authenticated"}))}else e((0,er.q7)()),localStorage.removeItem("token")}catch(t){console.error("Failed to decode or fetch user data:",t),e((0,er.q7)()),localStorage.removeItem("token")}})()},[e])},eS=[{kind:"header",title:"Main items"},{segment:"dashboard",title:"Dashboard",icon:(0,i.jsx)(o.A,{})},{segment:"test",title:"TestZone",icon:(0,i.jsx)(v.A,{})},{kind:"divider"},{kind:"header",title:"Setup"},{segment:"setup",title:"Pdf Design",icon:(0,i.jsx)(l.A,{}),children:[{segment:"pdf-template",title:"Template",icon:(0,i.jsx)(A.A,{})},{segment:"table-manage",title:"Table Manage",icon:(0,i.jsx)(y.A,{})},{segment:"media",title:"Media",icon:(0,i.jsx)(m.A,{})},{segment:"data-manage",title:"Config",icon:(0,i.jsx)(h.A,{})}]},{segment:"integrations",title:"Integrations",icon:(0,i.jsx)(s.A,{})},{segment:"organization",title:"Manage Organizations",icon:(0,i.jsx)(j.A,{})},{segment:"profile",title:"Manage Profile",icon:(0,i.jsx)(S.A,{})}],ew=(0,r.A)({colorSchemes:{light:{palette:{mode:"light",background:{default:"#f9f9f9",paper:"#ffffff"},text:{primary:"#000000",secondary:"#555555"}}},dark:{palette:{mode:"dark",background:{default:"#28292a",paper:"#28292a"},text:{primary:"#ffffff",secondary:"#b0b0b0"}}}},colorSchemeSelector:"class",breakpoints:{values:{xs:0,sm:600,md:600,lg:1200,xl:1536}}});function eb(e){var t,n,a;let{mini:r}=e,{organizations:o}=(0,D.d4)(e=>e.organization);return(0,i.jsxs)(x.A,{sx:{m:1,whiteSpace:"nowrap",overflow:"hidden"},children:[null!==(a=null===(t=o.find(e=>e.is_default))||void 0===t?void 0:t.name)&&void 0!==a?a:"No organization selected",r?"\xa9 ":" \xa9 ".concat(new Date(null===(n=o.find(e=>e.is_default))||void 0===n?void 0:n.updated_at).getFullYear()," Made with Pdf Tool")]})}function ez(e){ey();let{window:t}=e,[n,r]=a.useState(!1),o=(0,p.usePathname)(),l=function(e){let[t,n]=a.useState(e),i=(0,p.useRouter)(),{status:r}=(0,D.d4)(e=>e.session);return{pathname:t,searchParams:new URLSearchParams,navigate:e=>("/setup"==e?e="/setup/editor":"unauthenticated"===r&&"/"!=e&&"/test"!=e&&(e="/dashboard",ep.y.emit("triggerSignIn")),i.push(String(e)),n(String(e)))}}(null!=o?o:"/");if(a.useEffect(()=>{console.log(o,"Pathname"),r(!0)},[]),!n)return null;let s=t?t():void 0;return(0,i.jsx)(d.Dv,{navigation:eS,branding:{title:"PDF Crafter: HTML to PDF Tool",logo:(0,i.jsx)(f.A,{color:"info"})},router:l,theme:ew,window:s,children:(0,i.jsx)(u.N,{slots:{sidebarFooter:eb,toolbarActions:ej},children:(0,i.jsxs)(c.L,{children:[(0,i.jsx)(g.A,{container:!0,spacing:1}),e.children]})})})}},25033:(e,t,n)=>{"use strict";n.d(t,{n:()=>i});let i=n(82651).A.create({baseURL:"".concat("http://localhost:4000/api_/","v1"),timeout:3e4,headers:{"Content-Type":"application/json","Allow-Control-Allow-Origin":"*"}})},76487:(e,t,n)=>{"use strict";n.d(t,{AU:()=>o,EC:()=>r,lf:()=>l,xi:()=>a});var i=n(25033);let a=async(e,t)=>i.n.get("/organizations/"+e,{headers:{Authorization:"Bearer ".concat(t)}}),r=async(e,t)=>i.n.post("/organizations",e,{headers:{Authorization:"Bearer ".concat(t)}}),o=async(e,t)=>i.n.put("/organizations/"+e.id,e,{headers:{Authorization:"Bearer ".concat(t)}}),l=async(e,t)=>i.n.put("/organizations/"+e+"/default",{},{headers:{Authorization:"Bearer ".concat(t)}})},32731:(e,t,n)=>{"use strict";n.d(t,{y:()=>a});var i=n(41266);let a=new(n.n(i)())},90917:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>d,F3:()=>a,L_:()=>r,SH:()=>l,o_:()=>s,x5:()=>u});let i=(0,n(48943).Z0)({name:"organization",initialState:{organizations:[]},reducers:{addOrganizationAll(e,t){e.organizations=[...e.organizations,...t.payload]},addOrganization(e,t){e.organizations.push(t.payload)},updateOrganization(e,t){let n=e.organizations.findIndex(e=>e.id===t.payload.id);-1!==n&&(e.organizations[n]=t.payload)},removeOrganization(e,t){e.organizations=e.organizations.filter(e=>e.id!==t.payload)},clearOrganizationState(e){e.organizations=[]}}}),{addOrganization:a,updateOrganization:r,removeOrganization:o,addOrganizationAll:l,clearOrganizationState:s}=i.actions,d=i.reducer,u=e=>e.organizations.find(e=>e.is_default)||null},37264:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>c,Nq:()=>l,q7:()=>s,r1:()=>d});var i=n(48943),a=n(68488),r=n.n(a);let o=(0,i.Z0)({name:"session",initialState:{token:null,user:null,status:"unauthenticated"},reducers:{setSession:(e,t)=>{e.token=t.payload.token,e.user=t.payload.user,e.status="authenticated"},clearSession:e=>{e.token=null,e.user={id:null,name:"",email:"",profile:{id:null,theme:"light",avatar:null}},e.status="unauthenticated"},setLoading:e=>{e.status="loading"},validateSession:e=>{if(e.token)try{let t=r().decode(e.token);console.log("decoded",t),t&&1e3*t.exp<Date.now()?(e.token=null,e.user={id:null,name:"",email:"",profile:{id:null,theme:"light",avatar:null}},e.status="unauthenticated"):e.status="authenticated"}catch(t){console.error("Invalid token:",t),e.token=null,e.user={id:null,name:"",email:"",profile:{id:null,theme:"light",avatar:null}},e.status="unauthenticated"}else e.status="unauthenticated"}}}),{setSession:l,clearSession:s,setLoading:d,validateSession:u}=o.actions,c=o.reducer}},e=>{var t=t=>e(e.s=t);e.O(0,[9268,3333,6603,3391,3894,943,1064,5948,8943,2651,1043,5589,3655,2926,9905,2070,8442,6184,3693,611,1983,6287,9831,1543,6855,8441,1517,7358],()=>t(47446)),_N_E=e.O()}]);
//# sourceMappingURL=layout-385d93e15700c6ab.js.map